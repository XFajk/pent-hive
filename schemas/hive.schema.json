{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/hive.schema.json",
  "title": "Pent-Hive Hive",
  "type": "object",
  "required": ["pent_hive_spec", "metadata", "type"],
  "additionalProperties": false,
  "properties": {
    "pent_hive_spec": { "type": "string", "pattern": "^\\d+\\.\\d+$" },
    "metadata": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "owner": { "type": "string" },
        "tags": { "type": "array", "items": { "type": "string" } }
      }
    },
    "type": { "type": "string", "enum": ["HOST", "REMOTE", "CONTAINER"] },
    "connection": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "host": { "type": "string" },
        "user": { "type": "string" },
        "port": { "type": "integer", "minimum": 1 },
        "flags": { "type": "string" },
        "ssh_key_ref": { "type": "string" },
        "url": { "type": "string" }
      }
    },
    "container": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "image": { "type": "string" },
        "flags": { "type": "string" },
        "mounts": { "type": "array", "items": { "type": "string" } },
        "network_mode": { "type": "string" }
      }
    },
    "constraints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "allow_privileged": { "type": "boolean", "default": false },
        "allowed_networks": { "type": "array", "items": { "type": "string" } },
        "max_cpu": { "type": "string" },
        "max_memory": { "type": "string" }
      }
    },
    "consent_required": { "type": "boolean", "default": false },
    "consent_id": { "type": "string" }
  },
  "allOf": [
    {
      "if": { "properties": { "type": { "const": "REMOTE" } } },
      "then": {
        "required": ["connection"],
        "properties": {
          "connection": {
            "required": ["host", "user"],
            "properties": {
              "port": { "type": "integer", "minimum": 1 }
            }
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "CONTAINER" } } },
      "then": { "required": ["container"] }
    }
  ]
}